# Supervisor配置 - 管理Gunicorn进程
# 用途：自动启动、重启、监控Gunicorn
# 部署路径：/etc/supervisor/conf.d/health_app.conf

[program:health_app]
# 项目路径
directory=/path/to/health_app  # 修改为实际路径

# 启动命令
command=/path/to/venv/bin/gunicorn -c /path/to/deploy/gunicorn.conf.py health_report.wsgi:application

# 用户
user=www-data

# 自动启动
autostart=true

# 自动重启
autorestart=true

# 启动延迟（秒）
startsecs=10

# 重启尝试次数
startretries=3

# 停止信号
stopsignal=TERM

# 停止超时（秒）- 等待优雅停止
stopwaittimeout=600

# 重定向输出
stdout_logfile=/var/log/supervisor/health_app_stdout.log
stderr_logfile=/var/log/supervisor/health_app_stderr.log

# 日志文件大小
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB

# 日志文件备份数量
stdout_logfile_backups=10
stderr_logfile_backups=10

# 环境变量
environment=
    DJANGO_SETTINGS_MODULE="health_report.settings",
    PYTHONPATH="/path/to/health_app"

# 进程优先级（-20最高，19最低）
priority=999

# ======== 常用Supervisor命令 ========
# 启动：supervisorctl start health_app
# 停止：supervisorctl stop health_app
# 重启：supervisorctl restart health_app
# 状态：supervisorctl status health_app
# 查看日志：supervisorctl tail -f health_app
# 重新加载配置：supervisorctl reread && supervisorctl update
# ====================================
