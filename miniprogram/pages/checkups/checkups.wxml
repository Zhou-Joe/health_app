<!--pages/checkups/checkups.wxml-->
<view class="checkups-container app-theme">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration">
    <view class="blob blob-1"></view>
    <view class="blob blob-2"></view>
  </view>

  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left">
      <text class="header-emoji">ğŸ“‹</text>
      <view class="header-text">
        <text class="header-title">ä½“æ£€æŠ¥å‘Š</text>
        <text class="header-subtitle">{{checkups.length}} ä»½æŠ¥å‘Š</text>
      </view>
    </view>
    <view class="header-actions">
      <view class="batch-download-btn" bindtap="toggleSelectMode" wx:if="{{checkups.length > 0 && !isSelectMode}}">
        <text class="batch-icon">ğŸ“Š</text>
        <text class="batch-text">æ•°æ®æ•´åˆå¯¼å‡º</text>
      </view>
      <view class="cancel-select-btn" bindtap="toggleSelectMode" wx:if="{{isSelectMode}}">
        <text class="cancel-text">å–æ¶ˆé€‰æ‹©</text>
        <text class="cancel-icon">âœ•</text>
      </view>
      <view class="header-action" bindtap="goToUpload">
        <text class="add-icon">+</text>
      </view>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ ï¼ˆé€‰æ‹©æ¨¡å¼æ—¶æ˜¾ç¤ºï¼‰ -->
  <view class="batch-actions" wx:if="{{isSelectMode}}">
    <view class="batch-info">
      <text class="selected-count">å·²é€‰æ‹© {{selectedIds.length}} ä»½</text>
    </view>
    <view class="batch-buttons">
      <view class="batch-btn select-all-btn" bindtap="toggleSelectAll">
        <text>{{selectAll ? 'âœ“' : ''}} å…¨é€‰</text>
      </view>
      <view class="batch-btn download-pdf-btn" bindtap="exportSelected" data-format="pdf">
        <text class="btn-icon">ğŸ“„</text>
        <text>å¯¼å‡ºPDF</text>
      </view>
      <view class="batch-btn download-word-btn" bindtap="exportSelected" data-format="word">
        <text class="btn-icon">ğŸ“</text>
        <text>å¯¼å‡ºWord</text>
      </view>
    </view>
  </view>

  <!-- æŠ¥å‘Šåˆ—è¡¨ -->
  <view class="reports-list" wx:if="{{checkups.length > 0}}">
    <view class="report-card {{isSelectMode ? 'select-mode' : ''}} {{item.selected ? 'selected' : ''}}"
          wx:for="{{checkups}}"
          wx:key="id"
          bindtap="goToDetail"
          data-id="{{item.id}}">
      <!-- é€‰æ‹©å¤é€‰æ¡†ï¼ˆé€‰æ‹©æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
      <view class="checkbox-wrapper" wx:if="{{isSelectMode}}" catchtap="toggleSelect" data-id="{{item.id}}">
        <view class="checkbox {{item.selected ? 'checked' : ''}}">
          <text class="check-icon" wx:if="{{item.selected}}">âœ“</text>
        </view>
      </view>

      <!-- å¡ç‰‡å¤´éƒ¨ -->
      <view class="card-top">
        <view class="hospital-info">
          <text class="hospital-emoji">ğŸ¥</text>
          <view class="hospital-text">
            <text class="hospital-name">{{item.hospital || 'ä½“æ£€æŠ¥å‘Š'}}</text>
            <text class="report-date">{{item.checkup_date}}</text>
          </view>
        </view>
        <view class="status-dot status-{{item.status}}"></view>
      </view>

      <!-- å¡ç‰‡å†…å®¹ -->
      <view class="card-middle">
        <view class="stat-item">
          <text class="stat-number">{{item.indicators_count}}</text>
          <text class="stat-label">é¡¹æŒ‡æ ‡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number {{item.abnormal_count > 0 ? 'stat-warning' : 'stat-success'}}">{{item.abnormal_count || 0}}</text>
          <text class="stat-label">å¼‚å¸¸</text>
        </view>
      </view>

      <!-- å¡ç‰‡åº•éƒ¨ -->
      <view class="card-bottom">
        <text class="card-note">{{item.notes || 'å¸¸è§„ä½“æ£€'}}</text>
        <text class="card-arrow" wx:if="{{!isSelectMode}}">â†’</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <view class="empty-content">
      <text class="empty-emoji">ğŸ“„</text>
      <text class="empty-title">è¿˜æ²¡æœ‰æŠ¥å‘Š</text>
      <text class="empty-desc">ä¸Šä¼ ç¬¬ä¸€ä»½ä½“æ£€æŠ¥å‘Šå¼€å§‹è®°å½•</text>
      <view class="empty-btn" bindtap="goToUpload">
        <text class="empty-btn-text">ç«‹å³ä¸Šä¼ </text>
      </view>
    </view>
  </view>
</view>
