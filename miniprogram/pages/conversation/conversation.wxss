/* pages/conversation/conversation.wxss */

page {
  height: 100%;
  background: #e8f2ff;
}

.conversation-page {
  position: relative;
  height: 100%;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: linear-gradient(180deg, #eaf3ff 0%, #f5f9ff 48%, #fbfdff 100%);
  overflow: hidden;
}

.ambient-layer {
  position: absolute;
  pointer-events: none;
  border-radius: 999rpx;
  filter: blur(0);
}

.ambient-a {
  width: 520rpx;
  height: 520rpx;
  top: -180rpx;
  right: -130rpx;
  background: radial-gradient(circle, rgba(43, 132, 240, 0.28) 0%, rgba(43, 132, 240, 0) 70%);
}

.ambient-b {
  width: 460rpx;
  height: 460rpx;
  left: -120rpx;
  bottom: 180rpx;
  background: radial-gradient(circle, rgba(40, 198, 172, 0.22) 0%, rgba(40, 198, 172, 0) 72%);
}

.top-shell {
  position: relative;
  z-index: 5;
  padding: 30rpx 22rpx 14rpx;
}

.topbar {
  display: flex;
  align-items: center;
  gap: 16rpx;
}

.icon-btn {
  width: 74rpx;
  height: 74rpx;
  border-radius: 22rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.96);
  border: 1rpx solid rgba(54, 121, 205, 0.18);
  box-shadow: 0 10rpx 22rpx rgba(25, 78, 145, 0.14);
}

.icon-btn:active {
  transform: scale(0.96);
}

.icon-text {
  font-size: 46rpx;
  color: #1f5b95;
  line-height: 1;
}

.topbar-center {
  flex: 1;
  min-width: 0;
  display: flex;
  align-items: center;
  gap: 14rpx;
  padding: 6rpx 0;
}

.doctor-badge {
  position: relative;
  width: 78rpx;
  height: 78rpx;
  padding: 4rpx;
  border-radius: 39rpx;
  background: linear-gradient(145deg, rgba(47, 141, 255, 0.24), rgba(39, 189, 177, 0.18));
  flex-shrink: 0;
}

.doctor-avatar {
  width: 70rpx;
  height: 70rpx;
  border-radius: 35rpx;
  background: #ffffff;
  border: 2rpx solid rgba(255, 255, 255, 0.95);
}

.doctor-label {
  position: absolute;
  right: -8rpx;
  bottom: -6rpx;
  min-width: 34rpx;
  height: 34rpx;
  border-radius: 17rpx;
  padding: 0 8rpx;
  line-height: 34rpx;
  text-align: center;
  font-size: 18rpx;
  font-weight: 700;
  color: #ffffff;
  background: linear-gradient(145deg, #2f8dff, #2a6fd3);
}

.title-wrap {
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 4rpx;
}

.conv-title {
  font-size: 32rpx;
  font-weight: 700;
  color: #133d6b;
  line-height: 1.2;
}

.conv-subtitle {
  font-size: 22rpx;
  color: #5f7ea2;
  line-height: 1.3;
}

.top-action-btn {
  width: 94rpx;
}

.action-label {
  font-size: 23rpx;
  color: #1f5f9f;
  font-weight: 700;
}

.meta-strip {
  margin-top: 14rpx;
  display: flex;
  gap: 10rpx;
}

.mode-pill,
.binding-pill {
  border-radius: 999rpx;
  border: 1rpx solid rgba(66, 132, 216, 0.24);
  background: rgba(255, 255, 255, 0.9);
  padding: 9rpx 18rpx;
}

.mode-pill text,
.binding-pill text {
  font-size: 22rpx;
  color: #3d6791;
}

.mode-pill {
  flex-shrink: 0;
}

.mode-pill.continue {
  background: rgba(49, 129, 231, 0.14);
  border-color: rgba(49, 129, 231, 0.36);
}

.mode-pill.continue text {
  color: #1d5fb8;
}

.binding-pill {
  flex: 1;
  min-width: 0;
}

.binding-pill text {
  display: block;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chat-scroll {
  position: relative;
  z-index: 2;
  flex: 1;
  height: 0;
  min-height: 0;
  padding: 0 20rpx;
  -webkit-overflow-scrolling: touch;
}

.chat-track {
  padding: 8rpx 2rpx 20rpx 2rpx;
}

.msg-row {
  display: flex;
  align-items: flex-start;
  margin-bottom: 22rpx;
  gap: 10rpx;
}

.msg-row.incoming {
  justify-content: flex-start;
}

.msg-row.outgoing {
  justify-content: flex-end;
  padding-right: 10rpx;
}

.msg-avatar {
  width: 56rpx;
  height: 56rpx;
  border-radius: 18rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.msg-avatar.ai {
  background: linear-gradient(145deg, rgba(44, 137, 247, 0.18), rgba(41, 184, 176, 0.16));
  border: 1rpx solid rgba(70, 137, 217, 0.16);
  border-radius: 18rpx;
}

.msg-ai-avatar {
  width: 46rpx;
  height: 46rpx;
  border-radius: 50%;
  background: #ffffff;
}

.msg-avatar.self {
  background: linear-gradient(145deg, #3f94ff, #2a70d6);
  box-shadow: 0 8rpx 18rpx rgba(35, 99, 186, 0.28);
  overflow: hidden;
  border-radius: 50%;
  align-self: flex-start;
  margin-left: 2rpx;
}

.msg-avatar.self text {
  font-size: 22rpx;
  color: #ffffff;
  font-weight: 700;
}

.msg-user-avatar {
  width: 56rpx;
  height: 56rpx;
  border-radius: 50%;
  display: block;
  background: #ffffff;
}

.msg-main {
  max-width: calc(100% - 70rpx);
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 8rpx;
}

.msg-row.outgoing .msg-main {
  align-items: flex-end;
}

.msg-row.incoming .msg-main {
  align-items: flex-start;
}

.msg-card {
  position: relative;
  border-radius: 24rpx;
  padding: 20rpx 22rpx;
  word-break: break-word;
  box-sizing: border-box;
}

.msg-user-card {
  background: linear-gradient(145deg, #3d90ff, #2a70d6);
  box-shadow: 0 10rpx 22rpx rgba(31, 92, 177, 0.3);
}

.ai-card {
  background: linear-gradient(180deg, #ffffff 0%, #f8fbff 100%);
  border: 1rpx solid rgba(75, 141, 219, 0.22);
  box-shadow: 0 10rpx 20rpx rgba(36, 90, 155, 0.12);
}

.msg-text,
.msg-rich {
  font-size: 28rpx;
  line-height: 1.72;
}

.user-text {
  color: #ffffff;
}

.ai-text,
.msg-rich {
  color: #223750;
}

.ai-card:not(.expanded) {
  max-height: 360rpx;
  overflow: hidden;
}

.ai-card:not(.expanded)::after {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 72rpx;
  background: linear-gradient(180deg, rgba(248, 251, 255, 0), rgba(248, 251, 255, 0.98) 82%);
}

.expand-tip {
  margin-top: 10rpx;
}

.expand-tip text {
  font-size: 21rpx;
  color: #2d79d8;
}

.msg-time {
  padding: 0 8rpx;
}

.msg-time text {
  font-size: 20rpx;
  color: #8ca3bc;
}

.thinking-row {
  display: flex;
  align-items: center;
  gap: 12rpx;
  margin: 8rpx 0 14rpx 66rpx;
}

.thinking-pulse {
  display: flex;
  gap: 8rpx;
  align-items: center;
  padding: 12rpx 16rpx;
  border-radius: 999rpx;
  background: rgba(255, 255, 255, 0.9);
  border: 1rpx solid rgba(79, 142, 220, 0.22);
}

.pulse-dot {
  width: 10rpx;
  height: 10rpx;
  border-radius: 50%;
  background: #4786d2;
  animation: dot-wave 1.1s infinite ease-in-out;
}

.pulse-dot-2 {
  animation-delay: 0.12s;
}

.pulse-dot-3 {
  animation-delay: 0.24s;
}

@keyframes dot-wave {
  0%, 80%, 100% {
    transform: scale(0.82);
    opacity: 0.42;
  }
  40% {
    transform: scale(1.15);
    opacity: 1;
  }
}

.thinking-label {
  font-size: 23rpx;
  color: #5f7da0;
}

.composer-shell {
  position: relative;
  z-index: 6;
  padding: 8rpx 16rpx calc(12rpx + env(safe-area-inset-bottom));
}

.composer {
  display: flex;
  align-items: flex-end;
  gap: 10rpx;
  padding: 12rpx;
  border-radius: 26rpx;
  background: rgba(246, 251, 255, 0.95);
  border: 1rpx solid rgba(76, 141, 220, 0.2);
  box-shadow: 0 14rpx 28rpx rgba(29, 86, 151, 0.16);
}

.attach-trigger {
  width: 72rpx;
  height: 72rpx;
  border-radius: 20rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #ffffff;
  border: 1rpx solid rgba(82, 144, 221, 0.26);
}

.attach-symbol {
  font-size: 36rpx;
  color: #2d74cf;
  line-height: 1;
}

.composer-input-wrap {
  flex: 1;
  min-height: 72rpx;
  max-height: 240rpx;
  border-radius: 20rpx;
  background: #ffffff;
  border: 1rpx solid rgba(83, 143, 218, 0.24);
  padding: 12rpx 18rpx;
}

.composer-input {
  width: 100%;
  font-size: 28rpx;
  line-height: 1.6;
  color: #1f3045;
}

.send-trigger {
  width: 102rpx;
  height: 72rpx;
  border-radius: 20rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #d2e4fa;
  border: 1rpx solid rgba(56, 120, 199, 0.22);
}

.send-trigger.active {
  background: linear-gradient(145deg, #3f93ff, #2b72d8);
  border-color: rgba(36, 96, 183, 0.65);
}

.send-label {
  font-size: 24rpx;
  color: #5f7ea3;
  font-weight: 700;
}

.send-trigger.active .send-label {
  color: #ffffff;
}

.overlay-menu {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 30;
}

.overlay-mask {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: rgba(8, 20, 36, 0.34);
}

.menu-panel {
  position: absolute;
  left: 16rpx;
  right: 16rpx;
  bottom: calc(126rpx + env(safe-area-inset-bottom));
  border-radius: 24rpx;
  padding: 18rpx;
  background: rgba(255, 255, 255, 0.98);
  box-shadow: 0 18rpx 38rpx rgba(23, 70, 126, 0.24);
}

.menu-head {
  margin-bottom: 12rpx;
}

.menu-title {
  font-size: 24rpx;
  color: #45698f;
}

.menu-grid {
  display: flex;
  gap: 12rpx;
}

.menu-option {
  position: relative;
  flex: 1;
  border-radius: 16rpx;
  border: 1rpx solid rgba(87, 145, 218, 0.24);
  background: #f6faff;
  padding: 18rpx 14rpx;
  text-align: center;
}

.option-icon {
  width: 48rpx;
  height: 48rpx;
  line-height: 48rpx;
  margin: 0 auto 8rpx;
  border-radius: 14rpx;
  font-size: 24rpx;
  color: #1c63ba;
  font-weight: 700;
  background: rgba(66, 138, 228, 0.16);
}

.option-title {
  font-size: 23rpx;
  color: #2f567f;
}

.option-count {
  position: absolute;
  top: 8rpx;
  right: 8rpx;
  min-width: 30rpx;
  height: 30rpx;
  border-radius: 15rpx;
  line-height: 30rpx;
  font-size: 19rpx;
  color: #ffffff;
  background: #2e80e2;
}

.selector-overlay {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 40;
}

.selector-mask {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: rgba(9, 22, 40, 0.36);
}

.selector-panel {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  max-height: 72vh;
  border-radius: 30rpx 30rpx 0 0;
  background: linear-gradient(180deg, #fcfeff 0%, #ffffff 100%);
  box-shadow: 0 -14rpx 34rpx rgba(22, 71, 132, 0.2);
  display: flex;
  flex-direction: column;
}

.selector-handle {
  width: 82rpx;
  height: 8rpx;
  border-radius: 4rpx;
  margin: 16rpx auto 10rpx;
  background: #d3e0ef;
}

.selector-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14rpx 24rpx 18rpx;
  border-bottom: 1rpx solid #e8f0fa;
}

.selector-title {
  font-size: 30rpx;
  color: #1d406a;
  font-weight: 700;
}

.selector-actions {
  display: flex;
  align-items: center;
  gap: 20rpx;
}

.selector-btn {
  font-size: 25rpx;
  color: #5c7ca3;
}

.selector-btn.primary {
  color: #236cc4;
  font-weight: 700;
}

.selector-status {
  padding: 30rpx 24rpx;
  text-align: center;
}

.selector-status text {
  font-size: 25rpx;
  color: #5c7ca3;
}

.selector-status.error text {
  color: #bf4d41;
}

.retry-action {
  display: inline-block;
  margin-top: 10rpx;
  color: #246dc4 !important;
  font-weight: 700;
}

.selector-list {
  flex: 1;
  padding: 14rpx 20rpx calc(24rpx + env(safe-area-inset-bottom));
}

.selector-item {
  display: flex;
  align-items: center;
  gap: 14rpx;
  padding: 18rpx;
  margin-bottom: 12rpx;
  border-radius: 18rpx;
  border: 1rpx solid #dce8f6;
  background: #f8fbff;
}

.selector-item.selected {
  background: rgba(66, 141, 234, 0.12);
  border-color: rgba(44, 123, 221, 0.44);
}

.selector-item-icon {
  width: 52rpx;
  height: 52rpx;
  line-height: 52rpx;
  text-align: center;
  border-radius: 14rpx;
  background: rgba(75, 148, 242, 0.14);
  color: #1d62b7;
  font-size: 25rpx;
  font-weight: 700;
}

.selector-item-content {
  flex: 1;
  min-width: 0;
}

.selector-item-title {
  display: block;
  font-size: 27rpx;
  color: #1f446d;
  font-weight: 600;
}

.selector-item-desc {
  display: block;
  margin-top: 4rpx;
  font-size: 22rpx;
  color: #6e89a6;
}

.selector-check {
  width: 38rpx;
  height: 38rpx;
  border-radius: 50%;
  border: 2rpx solid #c1d7ef;
  display: flex;
  align-items: center;
  justify-content: center;
}

.selector-check.checked {
  background: #327ddd;
  border-color: #327ddd;
}

.selector-check-text {
  font-size: 22rpx;
  color: #ffffff;
  font-weight: 700;
}
