<view class="detail-container app-theme">
  <view class="detail-hero card">
    <view class="hero-top">
      <view>
        <text class="hero-title">{{checkup.hospital || '体检报告详情'}}</text>
        <text class="hero-date">{{checkup.checkup_date || ''}}</text>
      </view>
      <view class="hero-badge">报告详情</view>
    </view>
    <text class="hero-subtitle">查看指标、补录数据或删除该报告</text>
  </view>

  <view class="info-card card">
    <view class="info-row"><text class="label">体检机构</text><text class="value">{{checkup.hospital || '未知'}}</text></view>
    <view class="info-row"><text class="label">体检日期</text><text class="value">{{checkup.checkup_date}}</text></view>
    <view class="action-row">
      <button class="delete-checkup-btn" bindtap="deleteCheckup">删除报告</button>
    </view>
  </view>

  <view class="notes-card card" wx:if="{{checkup.notes}}">
    <view class="notes-label">报告描述</view>
    <text class="notes-content">{{checkup.notes}}</text>
  </view>

  <view class="ai-summary-card card" wx:if="{{aiSummary || aiSummaryLoading || aiSummaryError}}">
    <view class="ai-summary-header">
      <text class="ai-summary-title">AI 报告解读</text>
      <view class="ai-summary-actions" wx:if="{{aiSummary && !aiSummaryLoading}}">
        <text class="ai-action-btn" bindtap="generateAiSummary">重新生成</text>
      </view>
    </view>

    <view class="ai-summary-loading" wx:if="{{aiSummaryLoading}}">
      <text>{{aiSummary ? '正在更新...' : '正在生成AI解读...'}}</text>
    </view>

    <view class="ai-summary-error" wx:elif="{{aiSummaryError}}">
      <text class="error-text">{{aiSummaryError}}</text>
      <text class="retry-btn" bindtap="generateAiSummary">重新生成</text>
    </view>

    <view class="ai-summary-content" wx:elif="{{aiSummary}}">
      <text>{{aiSummary}}</text>
    </view>

    <view class="ai-summary-empty" wx:else>
      <text>暂无AI解读</text>
      <text class="generate-btn" bindtap="generateAiSummary">生成解读</text>
    </view>
  </view>

  <view class="ai-summary-card card ai-summary-placeholder" wx:elif="{{indicators.length > 0}}" bindtap="generateAiSummary">
    <view class="placeholder-content">
      <text class="placeholder-icon">✨</text>
      <text class="placeholder-text">点击生成AI报告解读</text>
      <text class="placeholder-hint">基于体检指标智能分析</text>
    </view>
  </view>

  <view class="stats-card card">
    <view class="stat-item"><text class="stat-value">{{stats.total}}</text><text class="stat-label">总指标</text></view>
    <view class="stat-item"><text class="stat-value text-success">{{stats.normal}}</text><text class="stat-label">正常</text></view>
    <view class="stat-item"><text class="stat-value text-danger">{{stats.abnormal}}</text><text class="stat-label">异常</text></view>
  </view>

  <view class="indicators-card card">
    <view class="card-title flex-between">
      <text>健康指标</text>
      <text class="add-btn" bindtap="addIndicator">+ 添加</text>
    </view>
    <view class="indicator-list">
      <view class="indicator-item" wx:for="{{indicators}}" wx:key="id" bindtap="editIndicator" data-id="{{item.id}}">
        <view class="indicator-header">
          <text class="indicator-name">{{item.indicator_name}}</text>
          <view class="status-badge status-{{item.status}}">{{item.status === 'normal' ? '正常' : '异常'}}</view>
        </view>
        <view class="indicator-value">
          <text class="value">{{item.value}}</text>
          <text class="unit" wx:if="{{item.unit}}">{{item.unit}}</text>
        </view>
        <text class="reference" wx:if="{{item.reference_range}}">参考: {{item.reference_range}}</text>
      </view>
    </view>
  </view>
</view>
