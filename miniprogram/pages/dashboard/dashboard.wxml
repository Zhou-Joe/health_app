<!--pages/dashboard/dashboard.wxml-->
<view class="dashboard-container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration">
    <view class="blob blob-1"></view>
    <view class="blob blob-2"></view>
    <view class="blob blob-3"></view>
  </view>

  <!-- é¡¶éƒ¨ï¼šä¸å¯¹ç§°å¸ƒå±€ -->
  <view class="top-section">
    <view class="welcome-card">
      <view class="date-badge">
        <text class="day-text">{{currentDay}}</text>
        <text class="month-text">{{currentMonth}}</text>
      </view>
      <view class="welcome-text">
        <text class="greeting-main">Hi~</text>
        <text class="greeting-sub">{{userInfo.first_name || userInfo.username || 'ç”¨æˆ·'}}</text>
      </view>
    </view>

    <view class="avatar-section" bindtap="goToSettings">
      <view class="avatar-ring">
        <text class="avatar-emoji">{{userInfo.avatar || 'âœ¨'}}</text>
      </view>
      <view class="settings-dot"></view>
    </view>
  </view>

  <!-- å¥åº·è¯„åˆ†å¤§å¡ç‰‡ - è§†è§‰ç„¦ç‚¹ -->
  <view class="health-score-card" bindtap="goToCheckups">
    <view class="score-header">
      <view class="score-title-group">
        <text class="score-emoji">ğŸ’“</text>
        <text class="score-title">å¥åº·æŒ‡æ•°</text>
      </view>
      <view class="score-trend">
        <text class="trend-icon">{{healthTrend === 'up' ? 'â†—' : 'â†’'}}</text>
      </view>
    </view>

    <view class="score-display">
      <view class="score-circle">
        <text class="score-value">{{healthScore}}</text>
        <text class="score-max">/100</text>
      </view>
    </view>

    <view class="score-details">
      <view class="detail-item">
        <text class="detail-dot"></text>
        <text class="detail-text">{{scoreComment}}</text>
      </view>
    </view>
  </view>

  <!-- æ•°æ®å¡ç‰‡ - æ¨ªå‘æ»šåŠ¨ï¼Œæ‰“ç ´ç½‘æ ¼ -->
  <view class="stats-scroll">
    <view class="stat-card stat-primary" bindtap="goToCheckups">
      <view class="stat-inner">
        <text class="stat-number">{{stats.checkupCount}}</text>
        <text class="stat-label">ä»½æŠ¥å‘Š</text>
        <view class="stat-icon-bg">ğŸ“‹</view>
      </view>
    </view>

    <view class="stat-card stat-secondary" bindtap="goToCheckups">
      <view class="stat-inner">
        <text class="stat-number">{{stats.indicatorCount}}</text>
        <text class="stat-label">é¡¹æŒ‡æ ‡</text>
        <view class="stat-icon-bg">ğŸ“Š</view>
      </view>
    </view>

    <view class="stat-card stat-accent" bindtap="goToConversations">
      <view class="stat-inner">
        <text class="stat-number">{{stats.conversationCount}}</text>
        <text class="stat-label">æ¬¡å’¨è¯¢</text>
        <view class="stat-icon-bg">ğŸ’¬</view>
      </view>
    </view>
  </view>

  <!-- å¼‚å¸¸æé†’ - å¡ç‰‡é‡å è®¾è®¡ -->
  <view class="alert-section" wx:if="{{abnormalIndicators.length > 0}}">
    <view class="alert-card-main"
          bindtap="goToAbnormalIndicator"
          data-id="{{abnormalIndicators[0].id}}"
          data-checkup="{{abnormalIndicators[0].checkup_id}}">
      <view class="alert-left">
        <view class="alert-emoji-wrapper">
          <text class="alert-emoji">âš ï¸</text>
        </view>
      </view>
      <view class="alert-content">
        <text class="alert-title">éœ€è¦å…³æ³¨</text>
        <text class="alert-item">{{abnormalIndicators[0].indicator_name}}</text>
        <text class="alert-value">{{abnormalIndicators[0].value_display}} {{abnormalIndicators[0].unit}}</text>
      </view>
      <view class="alert-arrow">â†’</view>
    </view>

    <view class="alert-card-sub" wx:if="{{abnormalIndicators.length > 1}}" bindtap="goToCheckups">
      <text class="more-alert-text">è¿˜æœ‰ {{abnormalIndicators.length - 1}} é¡¹å¼‚å¸¸</text>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ - å¤§æŒ‰é’®ç½‘æ ¼ -->
  <view class="actions-grid">
    <view class="action-card action-upload" bindtap="goToUpload">
      <view class="action-bg-circle"></view>
      <text class="action-emoji">ğŸ“„</text>
      <text class="action-title">ä¸Šä¼ </text>
    </view>

    <view class="action-card action-ai" bindtap="goToAIAdvice">
      <view class="action-bg-circle"></view>
      <text class="action-emoji">ğŸ¤–</text>
      <text class="action-title">AIåŒ»ç”Ÿ</text>
    </view>

    <view class="action-card action-meds" bindtap="goToMedications">
      <view class="action-bg-circle"></view>
      <text class="action-emoji">ğŸ’Š</text>
      <text class="action-title">è¯å•</text>
    </view>

    <view class="action-card action-integration" bindtap="goToIntegration">
      <view class="action-bg-circle"></view>
      <text class="action-emoji">ğŸ”„</text>
      <text class="action-title">æ•´åˆ</text>
    </view>

    <view class="action-card action-trends" bindtap="goToTrends">
      <view class="action-bg-circle"></view>
      <text class="action-emoji">ğŸ“ˆ</text>
      <text class="action-title">è¶‹åŠ¿</text>
    </view>
  </view>

  <!-- æœ€æ–°æŠ¥å‘Š - æ—¶é—´è½´è®¾è®¡ -->
  <view class="reports-section">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘</text>
      <view class="section-line"></view>
      <text class="section-more" bindtap="goToCheckups">å…¨éƒ¨ â†’</text>
    </view>

    <view class="report-timeline" wx:if="{{recentCheckups.length > 0}}">
      <view class="timeline-item"
            wx:for="{{recentCheckups}}"
            wx:key="id"
            bindtap="goToCheckupDetail"
            data-id="{{item.id}}">
        <view class="timeline-dot"></view>
        <view class="timeline-content">
          <text class="report-name">{{item.hospital || 'ä½“æ£€æŠ¥å‘Š'}}</text>
          <view class="report-meta">
            <text class="report-date">{{item.checkup_date}}</text>
            <view class="report-badge">
              <text class="badge-count">{{item.indicators_count}}</text>
              <text class="badge-unit">é¡¹</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view class="empty-reports" wx:else>
      <text class="empty-emoji">ğŸŒ±</text>
      <text class="empty-text">å¼€å§‹è®°å½•å¥åº·</text>
    </view>
  </view>
</view>
