<!--pages/settings/settings.wxml-->
<view class="settings-container app-theme">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration">
    <view class="blob blob-1"></view>
    <view class="blob blob-2"></view>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="avatar-wrapper" bindtap="chooseAvatar">
      <image wx:if="{{userInfo.avatar_url}}"
             class="avatar-image"
             src="{{userInfo.avatar_url}}"
             mode="aspectFill"></image>
      <text wx:else class="avatar-emoji">{{userInfo.avatar || 'âœ¨'}}</text>
    </view>
    <view class="user-info">
      <text class="user-name">{{userInfo.first_name || userInfo.username || 'ç”¨æˆ·'}}</text>
    </view>
  </view>

  <!-- ä¸ªäººä¿¡æ¯ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">ä¸ªäººä¿¡æ¯</text>
    </view>
    <view class="section-list">
      <view class="list-item" bindtap="editNickname">
        <view class="item-left">
          <text class="item-label">æ˜µç§°</text>
        </view>
        <view class="item-right">
          <text class="item-value">{{userProfile.nickname || 'æœªè®¾ç½®'}}</text>
          <text class="item-arrow">â€º</text>
        </view>
      </view>

      <view class="list-item" bindtap="editGender">
        <view class="item-left">
          <text class="item-label">æ€§åˆ«</text>
        </view>
        <view class="item-right">
          <text class="item-value">{{userProfile.genderDisplay || 'æœªè®¾ç½®'}}</text>
          <text class="item-arrow">â€º</text>
        </view>
      </view>

      <view class="list-item" bindtap="editBirthDate">
        <view class="item-left">
          <text class="item-label">å‡ºç”Ÿæ—¥æœŸ</text>
        </view>
        <view class="item-right">
          <text class="item-value">{{userProfile.birthDate || 'æœªè®¾ç½®'}}</text>
          <text class="item-arrow">â€º</text>
        </view>
      </view>

      <view class="list-item">
        <view class="item-left">
          <text class="item-label">å¹´é¾„</text>
        </view>
        <view class="item-right">
          <text class="item-value">{{userProfile.age || 'æœªçŸ¥'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å…¶ä»– -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">å…¶ä»–</text>
    </view>
    <view class="section-list">
      <view class="list-item" bindtap="showAbout">
        <view class="item-left">
          <text class="item-label">å…³äº</text>
        </view>
        <view class="item-right">
          <text class="item-value">v1.8</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é€€å‡ºç™»å½• -->
  <view class="action-section">
    <button class="logout-btn" bindtap="handleLogout">é€€å‡ºç™»å½•</button>
  </view>
</view>

<!-- ä¿®æ”¹æ˜µç§°å¼¹çª— -->
<view class="modal-mask" wx:if="{{showEditModal}}" bindtap="closeModal">
  <view class="modal-container" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">ä¿®æ”¹{{editField.label}}</text>
      <text class="modal-close" bindtap="closeModal">âœ•</text>
    </view>
    <view class="modal-content">
      <!-- æ˜µç§°è¾“å…¥ -->
      <input wx:if="{{editField.key === 'nickname'}}"
             class="modal-input"
             value="{{editValue}}"
             bindinput="onEditInput"
             placeholder="è¯·è¾“å…¥æ˜µç§°" />

      <!-- æ€§åˆ«é€‰æ‹© -->
      <view wx:if="{{editField.key === 'gender'}}" class="gender-options">
        <view class="gender-option {{editValue === 'male' ? 'active' : ''}}"
              bindtap="selectGender"
              data-value="male">
          <text class="gender-icon">ğŸ‘¨</text>
          <text class="gender-text">ç”·</text>
        </view>
        <view class="gender-option {{editValue === 'female' ? 'active' : ''}}"
              bindtap="selectGender"
              data-value="female">
          <text class="gender-icon">ğŸ‘©</text>
          <text class="gender-text">å¥³</text>
        </view>
      </view>

      <!-- å‡ºç”Ÿæ—¥æœŸé€‰æ‹© -->
      <picker wx:if="{{editField.key === 'birthDate'}}"
              mode="date"
              value="{{editValue}}"
              end="{{today}}"
              bindchange="onBirthDateChange">
        <view class="picker-value">
          {{editValue || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'}}
        </view>
      </picker>
    </view>
    <view class="modal-actions">
      <button class="modal-btn cancel-btn" bindtap="closeModal">å–æ¶ˆ</button>
      <button class="modal-btn confirm-btn" bindtap="saveEdit" loading="{{saving}}">
        {{saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}}
      </button>
    </view>
  </view>
</view>
