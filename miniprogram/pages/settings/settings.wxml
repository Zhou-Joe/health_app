<!--pages/settings/settings.wxml-->
<view class="settings-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card card">
    <view class="user-avatar">ğŸ‘¤</view>
    <view class="user-info">
      <text class="user-name">{{userInfo.first_name || userInfo.username || 'ç”¨æˆ·'}}</text>
      <text class="user-desc">{{userInfo.email || ''}}</text>
    </view>
  </view>

  <!-- ä¸ªäººä¿¡æ¯ -->
  <view class="profile-section">
    <view class="section-title">ä¸ªäººä¿¡æ¯</view>
    <view class="profile-list card">
      <view class="profile-item" bindtap="editNickname">
        <text class="item-label">æ˜µç§°</text>
        <view class="item-value-row">
          <text class="item-value">{{userProfile.nickname || 'æœªè®¾ç½®'}}</text>
          <text class="item-arrow">â€º</text>
        </view>
      </view>

      <view class="profile-item" bindtap="editGender">
        <text class="item-label">æ€§åˆ«</text>
        <view class="item-value-row">
          <text class="item-value">{{userProfile.genderDisplay || 'æœªè®¾ç½®'}}</text>
          <text class="item-arrow">â€º</text>
        </view>
      </view>

      <view class="profile-item" bindtap="editBirthDate">
        <text class="item-label">å‡ºç”Ÿæ—¥æœŸ</text>
        <view class="item-value-row">
          <text class="item-value">{{userProfile.birthDate || 'æœªè®¾ç½®'}}</text>
          <text class="item-arrow">â€º</text>
        </view>
      </view>

      <view class="profile-item">
        <text class="item-label">å¹´é¾„</text>
        <view class="item-value-row">
          <text class="item-value">{{userProfile.age || 'æœªçŸ¥'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å…¶ä»– -->
  <view class="other-section">
    <view class="section-title">å…¶ä»–</view>
    <view class="other-list card">
      <view class="other-item" bindtap="showAbout">
        <text class="item-label">å…³äº</text>
        <text class="item-value">v1.0.0</text>
      </view>
    </view>
  </view>

  <!-- é€€å‡ºç™»å½• -->
  <view class="action-section">
    <button class="logout-btn" bindtap="handleLogout">é€€å‡ºç™»å½•</button>
  </view>
</view>

<!-- ä¿®æ”¹æ˜µç§°å¼¹çª— -->
<view class="modal-mask" wx:if="{{showEditModal}}" bindtap="closeModal">
  <view class="modal-container" catchtap="stopPropagation">
    <view class="modal-title">ä¿®æ”¹{{editField.label}}</view>
    <view class="modal-content">
      <!-- æ˜µç§°è¾“å…¥ -->
      <input wx:if="{{editField.key === 'nickname'}}"
             class="modal-input"
             value="{{editValue}}"
             bindinput="onEditInput"
             placeholder="è¯·è¾“å…¥æ˜µç§°" />

      <!-- æ€§åˆ«é€‰æ‹© -->
      <view wx:if="{{editField.key === 'gender'}}" class="gender-options">
        <view class="gender-option {{editValue === 'male' ? 'active' : ''}}"
              bindtap="selectGender"
              data-value="male">
          <text class="gender-icon">ğŸ‘¨</text>
          <text class="gender-text">ç”·</text>
        </view>
        <view class="gender-option {{editValue === 'female' ? 'active' : ''}}"
              bindtap="selectGender"
              data-value="female">
          <text class="gender-icon">ğŸ‘©</text>
          <text class="gender-text">å¥³</text>
        </view>
      </view>

      <!-- å‡ºç”Ÿæ—¥æœŸé€‰æ‹© -->
      <picker wx:if="{{editField.key === 'birthDate'}}"
              mode="date"
              value="{{editValue}}"
              end="{{today}}"
              bindchange="onBirthDateChange">
        <view class="picker-value">
          {{editValue || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'}}
        </view>
      </picker>
    </view>
    <view class="modal-actions">
      <button class="modal-btn cancel-btn" bindtap="closeModal">å–æ¶ˆ</button>
      <button class="modal-btn confirm-btn" bindtap="saveEdit" loading="{{saving}}">
        {{saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}}
      </button>
    </view>
  </view>
</view>
