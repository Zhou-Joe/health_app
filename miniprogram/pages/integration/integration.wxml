<view class="integration-container">
  <view class="intro-card card">
    <view class="card-title">数据智能整合</view>
    <text class="intro-text">选择多份体检报告，AI将自动统一指标名称、单位和参考范围</text>
  </view>

  <view class="checkups-list card">
    <view class="section-title">选择要整合的报告（至少2份）</view>
    <view class="checkup-item" wx:for="{{checkups}}" wx:key="id">
      <view class="checkbox" bindtap="toggleSelection" data-id="{{item.id}}">
        <view class="checkbox-icon {{selectedIdSet[item.id] ? 'checked' : ''}}">
          {{selectedIdSet[item.id] ? '✓' : ''}}
        </view>
      </view>
      <view class="checkup-info" bindtap="toggleSelection" data-id="{{item.id}}">
        <text class="hospital">{{item.hospital}}</text>
        <text class="date">{{item.checkup_date}} · {{item.indicators_count}}项</text>
      </view>
    </view>
  </view>

  <!-- 自定义提示词 -->
  <view class="user-prompt-card card">
    <view class="section-title">自定义提示词（可选）</view>
    <textarea
      class="prompt-input"
      placeholder="例如：请特别关注血压、血糖指标；确保日期格式统一..."
      value="{{userPrompt}}"
      bindinput="onPromptInput"
      maxlength="200"
    />
    <text class="prompt-hint">可选。添加你希望AI特别关注的方面，留空则使用默认规则</text>
  </view>

  <view class="action-area">
    <text class="selected-count">已选择 {{selectedIds.length}} 份报告</text>
    <button class="integrate-btn btn-primary"
            bindtap="handleIntegrate"
            disabled="{{selectedIds.length < 2 || integrating}}"
            loading="{{integrating}}">
      {{integrating ? '整合中...' : '开始整合'}}
    </button>
  </view>
</view>
