<!--pages/trends/trends.wxml-->
<view class="trends-container app-theme">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration">
    <view class="blob blob-1"></view>
    <view class="blob blob-2"></view>
  </view>

  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left">
      <text class="header-emoji">ğŸ“ˆ</text>
      <view class="header-text">
        <text class="header-title">å¥åº·è¶‹åŠ¿</text>
        <text class="header-subtitle">è¿½è¸ªæ‚¨çš„å¥åº·å˜åŒ–</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-section" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && trendGroups.length === 0}}">
    <text class="empty-emoji">ğŸ“Š</text>
    <text class="empty-text">æš‚æ— è¶‹åŠ¿æ•°æ®</text>
    <text class="empty-hint">éœ€è¦è‡³å°‘2æ¬¡ä½“æ£€è®°å½•æ‰èƒ½æ˜¾ç¤ºè¶‹åŠ¿</text>
  </view>

  <!-- è¶‹åŠ¿åˆ†ç»„åˆ—è¡¨ -->
  <view class="trends-list" wx:if="{{!loading}}">
    <view class="type-group"
          wx:for="{{trendGroups}}"
          wx:key="typeName">

      <!-- ç±»å‹æ ‡é¢˜ï¼ˆå¯ç‚¹å‡»å±•å¼€/æŠ˜å ï¼‰ -->
      <view class="type-header" bindtap="toggleGroup" data-index="{{index}}">
        <view class="type-info">
          <text class="type-icon">{{item.typeIcon}}</text>
          <text class="type-name">{{item.typeName}}</text>
          <text class="type-count">({{item.indicators.length}}é¡¹)</text>
        </view>
        <view class="expand-icon {{item.expanded ? 'expanded' : ''}}">â–¼</view>
      </view>

      <!-- æŒ‡æ ‡åˆ—è¡¨ï¼ˆå±•å¼€æ—¶æ˜¾ç¤ºï¼‰ -->
      <view class="indicators-list {{item.expanded ? 'expanded' : ''}}" wx:if="{{item.expanded}}">
        <view class="trend-card"
              wx:for="{{item.indicators}}"
              wx:for-item="indicator"
              wx:key="name">
          <view class="card-header">
            <text class="indicator-name">{{indicator.name}}</text>
            <view class="latest-value {{indicator.latestStatus}}">
              <text class="value-text">{{indicator.latestValue}}</text>
              <text class="value-unit">{{indicator.unit}}</text>
            </view>
          </view>

          <!-- è¿·ä½ è¶‹åŠ¿å›¾ -->
          <view class="mini-chart">
            <view class="chart-bar"
                  wx:for="{{indicator.data}}"
                  wx:for-item="point"
                  wx:for-index="pointIndex"
                  wx:key="id"
                  style="height: {{point.height}}%; background: {{point.color}};">
            </view>
          </view>

          <!-- è¶‹åŠ¿ç»Ÿè®¡ -->
          <view class="trend-stats">
            <view class="stat-item">
              <text class="stat-label">å‚è€ƒå€¼</text>
              <text class="stat-value stat-reference">{{indicator.reference || '-'}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">è¶‹åŠ¿</text>
              <text class="stat-value {{indicator.trendDirection}}">{{indicator.trendText}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">æ¬¡æ•°</text>
              <text class="stat-value">{{indicator.count}}æ¬¡</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
