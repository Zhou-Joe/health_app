<view class="event-detail-page app-theme">
  <view class="header-card" wx:if="{{event}}">
    <view class="header-top">
      <text class="event-title">{{event.name}}</text>
      <text class="event-type">{{eventTypeLabel}}</text>
    </view>

    <view class="header-meta">
      <view class="meta-chip">
        <text>æ—¶é—´ {{dateRange}}</text>
      </view>
      <view class="meta-chip">
        <text>æŒç»­ {{event.duration_days}} å¤©</text>
      </view>
      <view class="meta-chip">
        <text>è®°å½• {{items.length}} æ¡</text>
      </view>
    </view>

    <text class="event-desc" wx:if="{{event.description}}">{{event.description}}</text>

    <view class="header-actions">
      <view class="header-btn" bindtap="openRenameModal">æ”¹å</view>
      <view class="header-btn header-btn-primary" bindtap="openReportPicker">æ·»åŠ æŠ¥å‘Š</view>
    </view>
  </view>

  <view class="section-title-wrap">
    <text class="section-title">ç»‘å®šè®°å½•</text>
  </view>

  <view class="record-list" wx:if="{{items.length > 0}}">
    <view class="record-item"
          wx:for="{{items}}"
          wx:key="id"
          bindtap="onTapItem"
          data-index="{{index}}">
      <view class="record-left">
        <text class="record-type">{{item.contentTypeLabel}}</text>
        <text class="record-summary">{{item.item_summary}}</text>
        <view class="record-subline">
          <text class="record-meta">{{item.added_at}}</text>
          <text class="record-meta">{{item.addedByLabel}}</text>
        </view>
        <text class="record-notes" wx:if="{{item.notes}}">å¤‡æ³¨ï¼š{{item.notes}}</text>
      </view>

      <view class="record-right">
        <view class="record-action-btn" catchtap="onTapItemAction" data-index="{{index}}">
          <text class="record-action">{{item.actionLabel}}</text>
        </view>
        <view class="record-remove-btn"
              wx:if="{{item.canRemoveReport}}"
              catchtap="onRemoveReportTap"
              data-item-id="{{item.id}}">
          <text class="record-remove-text">{{removingItemId === item.id ? 'ç§»é™¤ä¸­...' : 'ç§»é™¤'}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="empty-state" wx:else>
    <text class="empty-icon">ğŸ“­</text>
    <text class="empty-text">è¯¥äº‹ä»¶æš‚æ— ç»‘å®šè®°å½•</text>
  </view>

  <view class="modal-mask" wx:if="{{showRenameModal}}" catchtap="closeRenameModal">
    <view class="rename-modal" catchtap="noop">
      <text class="modal-title">ä¿®æ”¹äº‹ä»¶åç§°</text>
      <input class="rename-input"
             type="text"
             maxlength="64"
             placeholder="è¯·è¾“å…¥äº‹ä»¶åç§°"
             value="{{renameInput}}"
             bindinput="onRenameInput" />
      <view class="modal-actions">
        <view class="modal-btn modal-btn-cancel" bindtap="closeRenameModal">å–æ¶ˆ</view>
        <view class="modal-btn modal-btn-confirm" bindtap="confirmRename">
          {{savingRename ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}}
        </view>
      </view>
    </view>
  </view>

  <view class="modal-mask" wx:if="{{showReportPicker}}" catchtap="closeReportPicker">
    <view class="report-picker" catchtap="noop">
      <view class="report-picker-header">
        <text class="modal-title">æ·»åŠ ä½“æ£€æŠ¥å‘Š</text>
        <text class="picker-close" bindtap="closeReportPicker">å…³é—­</text>
      </view>

      <view class="picker-loading" wx:if="{{availableLoading}}">
        <text>æ­£åœ¨åŠ è½½å¯æ·»åŠ æŠ¥å‘Š...</text>
      </view>

      <scroll-view class="report-list-scroll" scroll-y wx:elif="{{availableReports.length > 0}}">
        <view class="report-option" wx:for="{{availableReports}}" wx:key="object_id">
          <view class="report-option-left">
            <text class="report-option-title">{{item.summary}}</text>
            <text class="report-option-date">{{item.date}}</text>
          </view>
          <view class="report-option-btn"
                catchtap="onAddReportTap"
                data-object-id="{{item.object_id}}">
            <text>{{addingReportId === item.object_id ? 'æ·»åŠ ä¸­...' : 'æ·»åŠ '}}</text>
          </view>
        </view>
      </scroll-view>

      <view class="picker-empty" wx:else>
        <text>æš‚æ— å¯æ·»åŠ çš„æŠ¥å‘Š</text>
      </view>
    </view>
  </view>
</view>
