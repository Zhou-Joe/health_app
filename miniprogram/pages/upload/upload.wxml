<!--pages/upload/upload.wxml-->
<view class="upload-container">
  <view class="upload-card card">
    <view class="card-title">上传体检报告</view>

    <!-- 上传区域 -->
    <view class="upload-area">
      <view wx:if="{{!filePath}}">
        <view class="upload-buttons">
          <button class="upload-btn" bindtap="chooseImage">
            <text class="btn-icon">📷</text>
            <text class="btn-text">选择照片</text>
          </button>
          <button class="upload-btn" bindtap="choosePDF">
            <text class="btn-icon">📄</text>
            <text class="btn-text">选择PDF</text>
          </button>
        </view>
        <view class="upload-tip">
          <text class="tip-text">支持上传体检报告、诊断报告、病症照片等，AI智能分析快速查询</text>
        </view>
      </view>
      <view wx:else class="file-info">
        <text class="file-name">{{fileName}}</text>
        <text class="file-remove" bindtap="removeFile" catchtap="removeFile">✕</text>
      </view>
    </view>

    <!-- 表单信息 -->
    <view class="form-section">
      <view class="form-item">
        <text class="form-label">体检日期</text>
        <picker mode="date" value="{{checkupDate}}" bindchange="onDateChange">
          <view class="form-value">{{checkupDate || '请选择日期'}}</view>
        </picker>
      </view>

      <view class="form-item">
        <text class="form-label">体检机构</text>
        <input class="form-input"
               placeholder="请输入体检机构名称"
               value="{{hospital}}"
               bindinput="onHospitalInput" />
      </view>

      <view class="form-item">
        <text class="form-label">报告描述</text>
        <input class="form-input"
               placeholder="如：年度体检、入职体检等（选填）"
               value="{{notes}}"
               bindinput="onNotesInput"
               maxlength="50" />
      </view>
    </view>

    <!-- 常用医院 -->
    <view class="common-hospitals" wx:if="{{commonHospitals.length > 0}}">
      <text class="section-label">常用机构</text>
      <view class="hospital-tags">
        <view class="hospital-tag"
              wx:for="{{commonHospitals}}"
              wx:key="name"
              bindtap="selectHospital"
              data-name="{{item.name}}">
          {{item.name}}
        </view>
      </view>
    </view>

    <!-- 提交按钮 -->
    <button class="submit-btn btn-primary"
            bindtap="handleSubmit"
            loading="{{uploading}}"
            disabled="{{!filePath || uploading}}">
      {{uploading ? '上传中...' : '开始上传'}}
    </button>
  </view>

  <!-- 处理进度 -->
  <view class="progress-card card" wx:if="{{showProgress}}">
    <view class="card-title">处理进度</view>
    <view class="progress-info">
      <text class="progress-status">{{statusText}}</text>
      <text class="progress-percent">{{progress}}%</text>
    </view>
    <progress percent="{{progress}}" stroke-width="8" activeColor="#4A90E2" />
    <text class="progress-tip" wx:if="{{progress < 100}}">正在处理中，请稍候...</text>
    <text class="progress-tip success" wx:else>✅ 处理完成，即将跳转到报告详情...</text>
  </view>
</view>
