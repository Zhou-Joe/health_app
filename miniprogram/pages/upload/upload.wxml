<!--pages/upload/upload.wxml-->
<view class="upload-container app-theme">
  <!-- 背景装饰 -->
  <view class="bg-decoration">
    <view class="blob blob-1"></view>
    <view class="blob blob-2"></view>
  </view>

  <!-- 页面标题 -->
  <view class="page-header">
    <view class="header-left">
      <text class="header-emoji">📄</text>
      <view class="header-text">
        <text class="header-title">上传报告</text>
        <text class="header-subtitle">AI 智能解析</text>
      </view>
    </view>
  </view>

  <!-- 上传区域 -->
  <view class="upload-section">
    <view class="upload-area {{filePath ? 'has-file' : ''}}" bindtap="{{!filePath ? 'doNothing' : ''}}">
      <view wx:if="{{!filePath}}" class="upload-content">
        <view class="upload-options">
          <view class="upload-option" bindtap="choosePDF">
            <view class="option-circle">
              <text class="option-icon">📄</text>
            </view>
            <text class="option-title">PDF报告</text>
            <text class="option-desc">体检报告/诊断书</text>
          </view>

          <view class="upload-option" bindtap="chooseImage">
            <view class="option-circle">
              <text class="option-icon">📷</text>
            </view>
            <text class="option-title">照片</text>
            <text class="option-desc">病症照片/检查单</text>
          </view>
        </view>

        <view class="upload-tip">
          <text class="tip-icon">💡</text>
          <text class="tip-text">支持 PDF 报告、照片等格式</text>
        </view>
      </view>

      <view wx:else class="file-card">
        <view class="file-icon-wrapper">
          <text class="file-icon">📋</text>
        </view>
        <view class="file-info">
          <text class="file-name">{{fileName}}</text>
          <text class="file-size">{{fileSize}}</text>
        </view>
        <view class="file-remove" catchtap="removeFile">
          <text class="remove-icon">✕</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 表单信息 -->
  <view class="form-section">
    <view class="form-card">
      <view class="form-item">
        <text class="form-label">
          <text class="label-icon">📅</text>
          体检日期
        </text>
        <picker mode="date" value="{{checkupDate}}" bindchange="onDateChange">
          <view class="form-picker {{checkupDate ? 'has-value' : ''}}">
            <text class="picker-text">{{checkupDate || '选择日期'}}</text>
            <text class="picker-arrow">↓</text>
          </view>
        </picker>
      </view>

      <view class="form-item">
        <text class="form-label">
          <text class="label-icon">🏥</text>
          体检机构
        </text>
        <input class="form-input"
               placeholder="输入机构名称"
               placeholder-class="input-placeholder"
               value="{{hospital}}"
               bindinput="onHospitalInput" />
      </view>

      <view class="form-item">
        <text class="form-label">
          <text class="label-icon">📝</text>
          报告描述
        </text>
        <input class="form-input"
               placeholder="如：年度体检、入职体检等"
               placeholder-class="input-placeholder"
               value="{{notes}}"
               bindinput="onNotesInput"
               maxlength="50" />
      </view>
    </view>
  </view>

  <!-- 常用医院 -->
  <view class="hospitals-section" wx:if="{{commonHospitals.length > 0}}">
    <view class="section-header-inline">
      <text class="section-title-inline">常用机构</text>
      <view class="section-line-short"></view>
    </view>
    <scroll-view class="hospital-scroll" scroll-x>
      <view class="hospital-tag"
            wx:for="{{commonHospitals}}"
            wx:key="name"
            bindtap="selectHospital"
            data-name="{{item.name}}">
        {{item.name}}
      </view>
    </scroll-view>
  </view>

  <!-- 提交按钮 -->
  <view class="submit-section">
    <button class="submit-btn"
            bindtap="handleSubmit"
            loading="{{uploading}}"
            disabled="{{!filePath || uploading}}">
      <view wx:if="{{!uploading}}" class="btn-content">
        <text class="btn-icon">🚀</text>
        <text>开始上传</text>
      </view>
      <text wx:else class="loading-text">处理中...</text>
    </button>
  </view>

  <!-- 处理进度 -->
  <view class="progress-modal" wx:if="{{showProgress}}">
    <view class="progress-content">
      <view class="progress-header">
        <text class="progress-title">{{progressTitle}}</text>
      </view>
      <view class="progress-bar-wrapper">
        <view class="progress-bar-bg">
          <view class="progress-bar-fill" style="width: {{progress}}%"></view>
        </view>
        <text class="progress-text">{{progress}}%</text>
      </view>
    </view>
  </view>
</view>
