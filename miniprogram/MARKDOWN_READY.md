# 小程序 Markdown 渲染功能

## ✅ 已就绪

AI对话页面已经支持完整的Markdown渲染，**无需安装任何额外库**！

## 支持的Markdown格式

- ✅ **代码块** - 深色背景代码块
- ✅ **行内代码** - 浅灰背景高亮
- ✅ **粗体** - **粗体文字**
- ✅ **斜体** - *斜体文字*
- ✅ **标题** - # ## ### 各级标题
- ✅ **列表** - 无序列表
- ✅ **引用** - 带边框的引用块

## 代码高亮示例

AI回复中的代码会自动格式化显示：

```javascript
function calculateBMI(weight, height) {
  return weight / (height * height)
}
```

**代码块样式：**
- 深色背景 (#282C34)
- 浅色文字 (#ABB2BF)
- 自动换行
- 等宽字体

**行内代码样式：**
- 浅灰背景
- 粉红色文字
- 圆角边框

## 标题样式

- **H1**: 20px，粗体
- **H2**: 18px，粗体
- **H3**: 16px，粗体

## 其他格式

- **粗体**: 加粗，深色
- **斜体**: 倾斜，灰色
- **列表**: 左侧缩进，圆点标记
- **引用**: 左侧紫色边框，浅灰背景

## 技术实现

使用微信小程序内置的 **rich-text** 组件，配合自定义的Markdown到HTML转换函数，实现轻量级Markdown渲染。

### 优点

- ✅ 无需安装第三方库
- ✅ 体积小，性能好
- ✅ 样式可控，自定义颜色
- ✅ 兼容性好，稳定可靠

## 使用示例

在AI对话中发送以下问题，可以看到格式化的回复：

1. "如何用Python计算BMI？"
   - 会返回带代码块的健康计算示例

2. "血压正常值是多少？"
   - 会返回带标题和引用的健康建议

3. "如何降低血糖？"
   - 会返回带列表的饮食建议

## 自定义样式

如需调整颜色或样式，修改 `conversation.js` 中的 `convertMarkdown` 函数：

```javascript
// 代码块颜色
.replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {
  return `<pre style="background:#你的颜色;color:#你的文字颜色...`
})

// 行内代码颜色
.replace(/`([^`]+)`/g, '<code style="background:#你的颜色...`')

// 引用颜色
.replace(/^>\s+(.*$)/gim, '<blockquote style="border-left:4px solid #你的颜色...`')
```

## 注意事项

1. 所有样式都使用内联CSS，确保在小程序中正确渲染
2. HTML特殊字符会自动转义，防止XSS攻击
3. 代码块支持横向滚动，不会破坏布局
4. 长文本自动换行，保持良好的阅读体验
